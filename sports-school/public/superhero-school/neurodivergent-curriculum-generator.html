<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Neurodivergent Curriculum Generator | ShotziOS</title>
    <link rel="stylesheet" href="/css/style.css" />
    <style>
      :root {
        --primary-color: #151c2b;
        --secondary-color: #0d1117;
        --accent-color: #3498db;
        --accent-dark: #2980b9;
        --text-color: #ecf0f1;
        --danger-color: #e74c3c;
        --warning-color: #e67e22;
        --success-color: #2ecc71;
        --purple-color: #9b59b6;
        --green-light: #4cd964;
        --card-bg: rgba(25, 35, 55, 0.9);
        --header-height: 60px;
        --nav-height: 50px;
        --border-radius: 8px;
        --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      body {
        font-family: 'Arial', sans-serif;
        margin: 0;
        padding: 0;
        background-color: var(--primary-color);
        color: var(--text-color);
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      header {
        background-color: var(--secondary-color);
        height: var(--header-height);
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 100%;
      }

      .logo {
        display: flex;
        align-items: center;
      }

      .logo img {
        height: 40px;
        margin-right: 10px;
      }

      .avatar {
        width: 40px;
        height: 40px;
        background-color: var(--accent-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        cursor: pointer;
      }

      nav {
        background-color: rgba(10, 17, 25, 0.8);
        height: var(--nav-height);
        position: sticky;
        top: var(--header-height);
        z-index: 99;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        overflow-x: auto;
      }

      .nav-links {
        display: flex;
        list-style: none;
        margin: 0;
        padding: 0;
        height: 100%;
      }

      .nav-links li {
        height: 100%;
        white-space: nowrap;
      }

      .nav-links a {
        display: flex;
        align-items: center;
        height: 100%;
        padding: 0 15px;
        color: var(--text-color);
        text-decoration: none;
        transition: all 0.3s ease;
      }

      .nav-links a:hover {
        background-color: rgba(50, 205, 50, 0.1); /* Using bright green highlight */
        color: var(--accent-color);
      }

      .nav-links a.active {
        background-color: rgba(52, 152, 219, 0.1);
        color: var(--accent-color);
        border-bottom: 3px solid var(--accent-color);
      }

      main {
        padding: 20px 0;
        min-height: calc(100vh - var(--header-height) - var(--nav-height));
      }

      h1 {
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 1.8rem;
      }

      .card {
        background-color: var(--card-bg);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        margin-bottom: 20px;
        overflow: hidden;
      }

      .card-header {
        background-color: rgba(52, 152, 219, 0.1);
        padding: 15px 20px;
        font-weight: bold;
        font-size: 1.1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .card-content {
        padding: 20px;
      }

      /* Form styles */
      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
      }

      select,
      input,
      textarea {
        width: 100%;
        padding: 10px 15px;
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: var(--border-radius);
        color: var(--text-color);
        font-size: 1rem;
      }

      select:focus,
      input:focus,
      textarea:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.3);
      }

      .btn {
        padding: 10px 20px;
        background-color: var(--accent-color);
        color: white;
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
      }

      .btn:hover {
        background-color: var(--accent-dark);
        transform: translateY(-2px);
      }

      .btn:disabled {
        background-color: #7f8c8d;
        cursor: not-allowed;
        transform: none;
      }

      .btn-outlined {
        background-color: transparent;
        border: 1px solid var(--accent-color);
        color: var(--accent-color);
      }

      .btn-outlined:hover {
        background-color: rgba(52, 152, 219, 0.1);
      }

      .btn-group {
        display: flex;
        gap: 10px;
      }

      /* Neurodivergent selector styles */
      .neurotype-selector {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 20px;
      }

      .neurotype-card {
        flex: 1 1 200px;
        background-color: rgba(0, 0, 0, 0.2);
        border: 2px solid transparent;
        border-radius: var(--border-radius);
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .neurotype-card:hover {
        transform: translateY(-3px);
        background-color: rgba(50, 205, 50, 0.05);
      }

      .neurotype-card.selected {
        border-color: var(--accent-color);
        background-color: rgba(52, 152, 219, 0.1);
      }

      .neurotype-title {
        font-weight: bold;
        font-size: 1.1rem;
        margin-bottom: 8px;
        color: var(--accent-color);
      }

      .neurotype-info {
        font-size: 0.9rem;
        margin-bottom: 10px;
      }

      .neurotype-strengths,
      .neurotype-accommodations {
        margin-top: 10px;
      }

      .neurotype-strengths h4,
      .neurotype-accommodations h4 {
        font-size: 0.9rem;
        margin-bottom: 5px;
        color: rgba(255, 255, 255, 0.7);
      }

      .neurotype-strengths ul,
      .neurotype-accommodations ul {
        margin: 0;
        padding-left: 20px;
        font-size: 0.85rem;
      }

      /* Loader */
      .loader-container {
        display: none;
        margin: 20px 0;
        text-align: center;
      }

      .loader {
        display: inline-block;
        width: 40px;
        height: 40px;
        border: 4px solid rgba(52, 152, 219, 0.3);
        border-radius: 50%;
        border-top-color: var(--accent-color);
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Results section */
      .results-container {
        display: none;
        margin-top: 30px;
      }

      .results-section {
        margin-bottom: 20px;
      }

      .results-section h3 {
        font-size: 1.2rem;
        color: var(--accent-color);
        margin-bottom: 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 5px;
      }

      .results-section ul {
        margin: 10px 0;
        padding-left: 20px;
      }

      .results-section p {
        line-height: 1.6;
        margin-bottom: 10px;
      }

      .results-tabs {
        display: flex;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 20px;
      }

      .tab {
        padding: 10px 20px;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
      }

      .tab:hover {
        background-color: rgba(50, 205, 50, 0.1);
      }

      .tab.active {
        border-bottom-color: var(--accent-color);
        color: var(--accent-color);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      /* Adaptive coloring for different neurotypes */
      .adhd-color {
        color: #3498db;
      }
      .autism-color {
        color: #9b59b6;
      }
      .dyslexia-color {
        color: #2ecc71;
      }
      .dyscalculia-color {
        color: #e74c3c;
      }
      .dyspraxia-color {
        color: #f39c12;
      }
      .sensory-color {
        color: #1abc9c;
      }
      .tourette-color {
        color: #e74c3c;
      }
      .executive-color {
        color: #3498db;
      }

      /* Download button */
      .download-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin-top: 15px;
      }

      .download-btn svg {
        width: 16px;
        height: 16px;
        fill: currentColor;
      }

      /* Responsive styles */
      @media (max-width: 768px) {
        .neurotype-selector {
          flex-direction: column;
        }

        .neurotype-card {
          flex: none;
        }

        .btn-group {
          flex-wrap: wrap;
        }

        .results-tabs {
          overflow-x: auto;
          white-space: nowrap;
          padding-bottom: 5px;
        }
      }
    </style>
    <!-- Accessibility Voice Guidance -->
    <script src="/js/accessibility-voice.js"></script>
  </head>
  <body>
    <header>
      <div class="container">
        <div class="header-content">
          <div class="logo">
            <img src="/logo.png" alt="ShotziOS Logo" />
            <span>ShotziOS Educational Platform</span>
          </div>
          <div class="avatar">S</div>
        </div>
      </div>
    </header>

    <nav>
      <div class="container">
        <ul class="nav-links">
          <li><a href="/dashboard">Dashboard</a></li>
          <li><a href="/superhero-school">Superhero School</a></li>
          <li><a href="/superhero-school/student-dashboard.html">Student Dashboard</a></li>
          <li>
            <a href="/superhero-school/dyslexia-curriculum-generator.html">Dyslexia Curriculum</a>
          </li>
          <li>
            <a href="/superhero-school/neurodivergent-curriculum-generator.html" class="active"
              >Neurodivergent Curriculum</a
            >
          </li>
          <li><a href="/superhero-school/learning-companion-demo.html">Learning Companion</a></li>
          <li><a href="/superhero-school/medication-tracker.html">Medication Tracker</a></li>
        </ul>
      </div>
    </nav>

    <main class="container">
      <h1>Neurodivergent Curriculum Generator</h1>

      <div class="card">
        <div class="card-header">
          <span>Generate Custom Learning Content for Neurodivergent Students</span>
          <button class="text-to-speech-btn" title="Read aloud">🔊</button>
        </div>
        <div class="card-content">
          <p>
            This AI-powered tool generates personalized, adaptive educational content tailored to
            specific neurodivergent types. The generated curriculum leverages each neurotype's
            unique strengths while providing necessary accommodations for optimal learning.
          </p>

          <p>
            Select a neurodivergent type below, then specify your subject, grade level, and learning
            format preferences to create customized educational materials.
          </p>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span>Select Neurodivergent Type</span>
        </div>
        <div class="card-content">
          <div class="neurotype-selector" id="neurotype-selector">
            <!-- Neurotype selection cards will be generated here -->
            <div class="neurotype-card" data-neurotype="adhd">
              <div class="neurotype-title adhd-color">ADHD</div>
              <div class="neurotype-info">
                Content optimized for attention differences, with shorter segments and more
                interactive elements.
              </div>
              <div class="neurotype-strengths">
                <h4>Strengths:</h4>
                <ul>
                  <li>Creativity</li>
                  <li>Hyperfocus</li>
                  <li>Outside-the-box thinking</li>
                </ul>
              </div>
            </div>

            <div class="neurotype-card" data-neurotype="autism">
              <div class="neurotype-title autism-color">Autism Spectrum</div>
              <div class="neurotype-info">
                Clear, explicit instruction with visual supports and predictable structure.
              </div>
              <div class="neurotype-strengths">
                <h4>Strengths:</h4>
                <ul>
                  <li>Pattern recognition</li>
                  <li>Detail orientation</li>
                  <li>Visual memory</li>
                </ul>
              </div>
            </div>

            <div class="neurotype-card" data-neurotype="dyslexia">
              <div class="neurotype-title dyslexia-color">Dyslexia</div>
              <div class="neurotype-info">
                Text optimized for readability with multi-sensory approaches to learning.
              </div>
              <div class="neurotype-strengths">
                <h4>Strengths:</h4>
                <ul>
                  <li>Big-picture thinking</li>
                  <li>Creativity</li>
                  <li>Spatial reasoning</li>
                </ul>
              </div>
            </div>

            <div class="neurotype-card" data-neurotype="dyscalculia">
              <div class="neurotype-title dyscalculia-color">Dyscalculia</div>
              <div class="neurotype-info">
                Visual and concrete approaches to math concepts with step-by-step instruction.
              </div>
              <div class="neurotype-strengths">
                <h4>Strengths:</h4>
                <ul>
                  <li>Verbal reasoning</li>
                  <li>Creative thinking</li>
                  <li>Conceptual understanding</li>
                </ul>
              </div>
            </div>

            <div class="neurotype-card" data-neurotype="dyspraxia">
              <div class="neurotype-title dyspraxia-color">Dyspraxia</div>
              <div class="neurotype-info">
                Learning activities with reduced motor demands and alternative response methods.
              </div>
              <div class="neurotype-strengths">
                <h4>Strengths:</h4>
                <ul>
                  <li>Verbal reasoning</li>
                  <li>Problem-solving</li>
                  <li>Empathy</li>
                </ul>
              </div>
            </div>

            <div class="neurotype-card" data-neurotype="sensory">
              <div class="neurotype-title sensory-color">Sensory Processing</div>
              <div class="neurotype-info">
                Content with sensory considerations and alternatives for different sensory
                preferences.
              </div>
              <div class="neurotype-strengths">
                <h4>Strengths:</h4>
                <ul>
                  <li>Heightened awareness</li>
                  <li>Attention to detail</li>
                  <li>Pattern recognition</li>
                </ul>
              </div>
            </div>

            <div class="neurotype-card" data-neurotype="tourette">
              <div class="neurotype-title tourette-color">Tourette Syndrome</div>
              <div class="neurotype-info">
                Flexible learning approaches with reduced time pressure and movement accommodations.
              </div>
              <div class="neurotype-strengths">
                <h4>Strengths:</h4>
                <ul>
                  <li>Cognitive flexibility</li>
                  <li>Creativity</li>
                  <li>Hyper-focus</li>
                </ul>
              </div>
            </div>

            <div class="neurotype-card" data-neurotype="executive">
              <div class="neurotype-title executive-color">Executive Function Support</div>
              <div class="neurotype-info">
                Learning materials with clear organization, task breakdowns, and visual schedules.
              </div>
              <div class="neurotype-strengths">
                <h4>Strengths:</h4>
                <ul>
                  <li>Creative problem-solving</li>
                  <li>Outside-the-box thinking</li>
                  <li>Adaptability</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span>Curriculum Parameters</span>
        </div>
        <div class="card-content">
          <form id="curriculum-form">
            <div class="form-group">
              <label for="subject">Subject Area:</label>
              <select id="subject" name="subject" required>
                <option value="">Select Subject</option>
                <option value="reading">Reading</option>
                <option value="writing">Writing</option>
                <option value="mathematics">Mathematics</option>
                <option value="science">Science</option>
                <option value="social-studies">Social Studies</option>
                <option value="language-arts">Language Arts</option>
                <option value="history">History</option>
                <option value="art">Art</option>
                <option value="music">Music</option>
                <option value="physical-education">Physical Education</option>
                <option value="computer-science">Computer Science</option>
                <option value="foreign-language">Foreign Language</option>
                <option value="economics">Economics</option>
                <option value="psychology">Psychology</option>
                <option value="biology">Biology</option>
                <option value="chemistry">Chemistry</option>
                <option value="physics">Physics</option>
              </select>
            </div>

            <div class="form-group">
              <label for="grade">Grade Level:</label>
              <select id="grade" name="grade" required>
                <option value="">Select Grade Level</option>
                <option value="K">Kindergarten</option>
                <option value="1">1st Grade</option>
                <option value="2">2nd Grade</option>
                <option value="3">3rd Grade</option>
                <option value="4">4th Grade</option>
                <option value="5">5th Grade</option>
                <option value="6">6th Grade</option>
                <option value="7">7th Grade</option>
                <option value="8">8th Grade</option>
                <option value="9">9th Grade</option>
                <option value="10">10th Grade</option>
                <option value="11">11th Grade</option>
                <option value="12">12th Grade</option>
                <option value="college-freshman">College Freshman</option>
                <option value="college-sophomore">College Sophomore</option>
                <option value="college-junior">College Junior</option>
                <option value="college-senior">College Senior</option>
                <option value="masters">Masters Level</option>
              </select>
            </div>

            <div class="form-group">
              <label for="topic">Specific Topic (optional):</label>
              <input
                type="text"
                id="topic"
                name="topic"
                placeholder="e.g., Fractions, American Revolution, Chemical Reactions"
              />
            </div>

            <div class="form-group">
              <label for="format">Learning Format:</label>
              <select id="format" name="format" required>
                <option value="">Select Format</option>
                <option value="text">Text-based with accessible formatting</option>
                <option value="visual">Visual guide with diagrams</option>
                <option value="step-by-step">Step-by-step instructions</option>
                <option value="mind-map">Mind mapping and visual organization</option>
                <option value="game">Game-based interactive lesson</option>
                <option value="sensory-friendly">Sensory-friendly lesson</option>
                <option value="audio">Audio narration script</option>
                <option value="chat">Adaptive chat-based learning</option>
              </select>
            </div>

            <div class="form-group">
              <label for="state">State Standards (optional):</label>
              <select id="state" name="state">
                <option value="general">General (No specific state)</option>
                <option value="CA">California</option>
                <option value="TX">Texas</option>
                <option value="NY">New York</option>
                <option value="FL">Florida</option>
                <option value="IL">Illinois</option>
                <option value="common-core">Common Core</option>
              </select>
            </div>

            <div class="btn-group">
              <button type="submit" class="btn" id="generate-btn">Generate Curriculum</button>
              <button type="reset" class="btn btn-outlined">Reset Form</button>
            </div>
          </form>

          <div class="loader-container" id="loader-container">
            <div class="loader"></div>
            <p>Generating your customized curriculum content...</p>
          </div>
        </div>
      </div>

      <div class="results-container" id="results-container">
        <div class="card">
          <div class="card-header">
            <span id="results-title">Generated Curriculum</span>
          </div>
          <div class="card-content">
            <div class="results-tabs">
              <div class="tab active" data-tab="overview">Overview</div>
              <div class="tab" data-tab="content">Content</div>
              <div class="tab" data-tab="resources">Resources</div>
              <div class="tab" data-tab="teacher">Teacher Notes</div>
            </div>

            <div class="tab-content active" id="overview-tab">
              <div class="results-section">
                <h3>Learning Objectives</h3>
                <ul id="learning-objectives"></ul>
              </div>

              <div class="results-section">
                <h3>Neurodivergent Strengths Utilized</h3>
                <ul id="strengths-utilized"></ul>
              </div>

              <div class="results-section">
                <h3>Specific Accommodations</h3>
                <ul id="accommodations"></ul>
              </div>

              <div class="results-section">
                <h3>Activities</h3>
                <ul id="activities"></ul>
              </div>
            </div>

            <div class="tab-content" id="content-tab">
              <div class="results-section">
                <h3>Main Content</h3>
                <div id="main-content"></div>
              </div>
            </div>

            <div class="tab-content" id="resources-tab">
              <div class="results-section">
                <h3>Visuals</h3>
                <ul id="visuals"></ul>
              </div>

              <div class="results-section">
                <h3>Assessment</h3>
                <ul id="assessment"></ul>
              </div>

              <div class="results-section">
                <h3>Additional Resources</h3>
                <ul id="additional-resources"></ul>
              </div>
            </div>

            <div class="tab-content" id="teacher-tab">
              <div class="results-section">
                <h3>Teacher Notes</h3>
                <div id="teacher-notes"></div>
              </div>
            </div>

            <button class="btn download-btn" id="download-btn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M12 16l-5-5h3V4h4v7h3l-5 5zm9 4v2H3v-2h18z" />
              </svg>
              Download Curriculum
            </button>
          </div>
        </div>
      </div>
    </main>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Elements
        const neurotypeCards = document.querySelectorAll('.neurotype-card');
        const curriculumForm = document.getElementById('curriculum-form');
        const generateBtn = document.getElementById('generate-btn');
        const loaderContainer = document.getElementById('loader-container');
        const resultsContainer = document.getElementById('results-container');
        const resultsTitle = document.getElementById('results-title');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const downloadBtn = document.getElementById('download-btn');
        const textToSpeechBtns = document.querySelectorAll('.text-to-speech-btn');

        // Result element IDs
        const resultElements = {
          learningObjectives: document.getElementById('learning-objectives'),
          strengthsUtilized: document.getElementById('strengths-utilized'),
          accommodations: document.getElementById('accommodations'),
          activities: document.getElementById('activities'),
          mainContent: document.getElementById('main-content'),
          visuals: document.getElementById('visuals'),
          assessment: document.getElementById('assessment'),
          additionalResources: document.getElementById('additional-resources'),
          teacherNotes: document.getElementById('teacher-notes'),
        };

        // Selected neurotype
        let selectedNeurotype = null;

        // Store generated content for download
        let generatedContent = null;

        // Neurotype selection
        neurotypeCards.forEach((card) => {
          card.addEventListener('click', function () {
            // Remove selected class from all cards
            neurotypeCards.forEach((c) => c.classList.remove('selected'));

            // Add selected class to this card
            this.classList.add('selected');

            // Store selected neurotype
            selectedNeurotype = this.dataset.neurotype;

            // Announce selection with voice guidance if available
            const neurotypeName = this.querySelector('.neurotype-title').textContent;
            if (window.accessibilityVoice) {
              window.accessibilityVoice.speak(
                `${neurotypeName} selected. Please configure your curriculum parameters below.`,
              );
            }
          });
        });

        // Tab switching
        tabs.forEach((tab) => {
          tab.addEventListener('click', function () {
            // Remove active class from all tabs
            tabs.forEach((t) => t.classList.remove('active'));
            tabContents.forEach((c) => c.classList.remove('active'));

            // Add active class to this tab
            this.classList.add('active');

            // Show corresponding content
            const tabId = this.dataset.tab + '-tab';
            document.getElementById(tabId).classList.add('active');
          });
        });

        // Form submission
        curriculumForm.addEventListener('submit', async function (e) {
          e.preventDefault();

          // Check if neurotype is selected
          if (!selectedNeurotype) {
            // Use voice guidance if available
            if (window.accessibilityVoice) {
              window.accessibilityVoice.speak(
                'Please select a neurodivergent type first before generating curriculum.',
              );
            }
            alert('Please select a neurodivergent type first.');
            return;
          }

          // Get form data
          const formData = new FormData(curriculumForm);
          const subject = formData.get('subject');
          const grade = formData.get('grade');
          const topic = formData.get('topic');
          const format = formData.get('format');
          const state = formData.get('state');

          // Show loader and hide results
          loaderContainer.style.display = 'block';
          resultsContainer.style.display = 'none';
          generateBtn.disabled = true;

          try {
            // Prepare request data
            const requestData = {
              subject,
              grade,
              topic: topic || `${subject} for ${grade}`,
              format,
              state: state || 'general',
              neurotype: selectedNeurotype,
            };

            // Call API to generate curriculum
            const response = await fetch('/api/neurodivergent-curriculum/generate-lesson', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(requestData),
            });

            if (!response.ok) {
              throw new Error('API request failed');
            }

            // Parse response
            const data = await response.json();
            generatedContent = data;

            // Display results
            displayResults(data);

            // Show results and hide loader
            loaderContainer.style.display = 'none';
            resultsContainer.style.display = 'block';
            generateBtn.disabled = false;

            // Scroll to results
            resultsContainer.scrollIntoView({ behavior: 'smooth' });

            // Announce that curriculum is ready with voice guidance if available
            if (window.accessibilityVoice) {
              window.accessibilityVoice.speak(
                `Curriculum for ${neurotype.toUpperCase()} students has been generated. The results are now displayed below.`,
              );
            }
          } catch (error) {
            console.error('Error generating curriculum:', error);

            // Try to use mock generation for testing when API is unavailable
            mockGenerateCurriculum(selectedNeurotype, subject, grade, topic, format);

            // Hide loader and enable button
            loaderContainer.style.display = 'none';
            generateBtn.disabled = false;
          }
        });

        // Text-to-speech buttons
        textToSpeechBtns.forEach((btn) => {
          btn.addEventListener('click', function () {
            const cardContent = this.closest('.card').querySelector('.card-content');
            const text = cardContent.textContent.trim();

            // Use our accessibility voice guidance system if available
            if (window.accessibilityVoice) {
              window.accessibilityVoice.speak(text);
            }
            // Fallback to browser's text-to-speech API
            else if ('speechSynthesis' in window) {
              const utterance = new SpeechSynthesisUtterance(text);
              window.speechSynthesis.speak(utterance);
            } else {
              alert('Sorry, your browser does not support text-to-speech!');
            }
          });
        });

        // Download button
        downloadBtn.addEventListener('click', function () {
          if (!generatedContent) return;

          // Prepare content for download
          const content = JSON.stringify(generatedContent, null, 2);
          const filename = `${generatedContent.neurotype}-${generatedContent.subject}-${generatedContent.grade_level}.json`;

          // Create blob and download link
          const blob = new Blob([content], { type: 'application/json' });
          const url = URL.createObjectURL(blob);

          // Create download link and trigger click
          const a = document.createElement('a');
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();

          // Clean up
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        });

        /**
         * Display results in the UI
         * @param {Object} data - Generated curriculum data
         */
        function displayResults(data) {
          // Set title
          resultsTitle.textContent = data.title || 'Generated Curriculum';

          // Clear previous results
          for (const key in resultElements) {
            resultElements[key].innerHTML = '';
          }

          // Learning objectives
          if (data.learning_objectives && data.learning_objectives.length > 0) {
            data.learning_objectives.forEach((objective) => {
              const li = document.createElement('li');
              li.textContent = objective;
              resultElements.learningObjectives.appendChild(li);
            });
          }

          // Strengths utilized
          if (data.strengths_utilized && data.strengths_utilized.length > 0) {
            data.strengths_utilized.forEach((strength) => {
              const li = document.createElement('li');
              li.textContent = strength;
              resultElements.strengthsUtilized.appendChild(li);
            });
          }

          // Accommodations
          if (data.accommodations && data.accommodations.length > 0) {
            data.accommodations.forEach((accommodation) => {
              const li = document.createElement('li');
              li.textContent = accommodation;
              resultElements.accommodations.appendChild(li);
            });
          }

          // Activities
          if (data.activities && data.activities.length > 0) {
            data.activities.forEach((activity) => {
              const li = document.createElement('li');
              li.textContent = activity;
              resultElements.activities.appendChild(li);
            });
          }

          // Main content
          if (data.content) {
            const formattedContent = data.content
              .replace(/\n\n/g, '</p><p>')
              .replace(/\n/g, '<br>')
              .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            resultElements.mainContent.innerHTML = `<p>${formattedContent}</p>`;
          }

          // Visuals
          if (data.visuals && data.visuals.length > 0) {
            data.visuals.forEach((visual) => {
              const li = document.createElement('li');
              li.textContent = visual;
              resultElements.visuals.appendChild(li);
            });
          }

          // Assessment
          if (data.assessment && data.assessment.length > 0) {
            data.assessment.forEach((question) => {
              const li = document.createElement('li');
              li.textContent = question;
              resultElements.assessment.appendChild(li);
            });
          }

          // Additional resources
          if (data.additional_resources && data.additional_resources.length > 0) {
            data.additional_resources.forEach((resource) => {
              const li = document.createElement('li');
              li.textContent = resource;
              resultElements.additionalResources.appendChild(li);
            });
          }

          // Teacher notes
          if (data.teacher_notes) {
            resultElements.teacherNotes.innerHTML = `<p>${data.teacher_notes.replace(/\n/g, '<br>')}</p>`;
          }
        }

        /**
         * Mock curriculum generation for testing
         * This function only runs when the API request fails
         */
        function mockGenerateCurriculum(neurotype, subject, grade, topic, format) {
          // Create a mock curriculum object
          const mockCurriculum = {
            title: `${topic || subject} for ${grade} Students with ${neurotype.toUpperCase()}`,
            grade_level: grade,
            subject: subject,
            topic: topic || subject,
            neurotype: neurotype.toUpperCase(),
            learning_objectives: [
              'Understand key concepts related to the topic',
              'Apply knowledge to real-world scenarios',
              'Develop critical thinking skills in this subject area',
            ],
            content:
              'This is a placeholder for curriculum content. In the real application, this would be detailed, personalized content tailored for the specific neurodivergent type.\n\nThe content would include explanations, examples, and interactive elements appropriate for the selected format.',
            accommodations: [
              'Visual supports for complex concepts',
              'Breaks divided throughout the learning session',
              'Multiple ways to demonstrate understanding',
            ],
            strengths_utilized: [
              'Creative thinking',
              'Pattern recognition',
              'Unique perspective on the subject matter',
            ],
            visuals: [
              'Concept map showing relationships between key ideas',
              'Visual timeline of important events or processes',
              'Color-coded diagram of main components',
            ],
            activities: [
              'Interactive group discussion with clear turn-taking',
              'Hands-on demonstration of concepts',
              'Digital exploration activity with immediate feedback',
            ],
            assessment: [
              'How do these concepts connect to real-world applications?',
              'What are the three most important things you learned?',
              'How would you explain this topic to someone else?',
            ],
            additional_resources: [
              'Interactive online practice modules',
              'Visual study guides with minimal text',
              'Video explanations with captions',
            ],
            teacher_notes:
              'These materials are designed specifically for students with ' +
              neurotype.toUpperCase() +
              '. Consider providing additional time for processing, frequent movement breaks, and multiple ways to demonstrate understanding. Leverage strengths in creative thinking and unique perspectives through open-ended activities.',
            format: format,
            api_source: 'mock (API unavailable)',
            timestamp: new Date().toISOString(),
          };

          // Store mock content for download
          generatedContent = mockCurriculum;

          // Display results
          displayResults(mockCurriculum);

          // Show results container
          resultsContainer.style.display = 'block';
        }
      });
    </script>
  </body>
</html>
