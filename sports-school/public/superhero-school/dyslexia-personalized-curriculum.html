<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Personalized Dyslexia Curriculum Generator | ShotziOS Neurodivergent Superhero School
    </title>
    <link rel="stylesheet" href="/css/neurodivergent-friendly.css" />
    <style>
      /* Core Styles for Dyslexia-Friendly UI */
      body {
        font-family: 'Open Sans', Arial, sans-serif;
        background-color: #111;
        color: #eee;
        line-height: 1.6;
        margin: 0;
        padding: 0;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 1px solid #333;
        padding-bottom: 20px;
      }

      .logo {
        max-width: 200px;
        margin-bottom: 15px;
      }

      h1,
      h2,
      h3,
      h4 {
        color: #00ccff;
        font-weight: 600;
        letter-spacing: 0.5px;
      }

      h1 {
        font-size: 2.2rem;
        margin-bottom: 10px;
      }

      h2 {
        font-size: 1.8rem;
        margin-top: 30px;
        margin-bottom: 20px;
      }

      h3 {
        font-size: 1.4rem;
        margin-top: 25px;
        margin-bottom: 15px;
      }

      p {
        margin-bottom: 20px;
        font-size: 1.1rem;
      }

      .dyslexia-friendly-text {
        font-size: 1.1rem;
        line-height: 1.7;
        letter-spacing: 0.2px;
        word-spacing: 2px;
      }

      /* Form Styles */
      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-size: 1.1rem;
        color: #00ccff;
      }

      select,
      input[type='text'] {
        width: 100%;
        padding: 12px 15px;
        font-size: 1.1rem;
        border: 2px solid #333;
        background-color: #222;
        color: #eee;
        border-radius: 6px;
        box-sizing: border-box;
      }

      select:focus,
      input[type='text']:focus {
        outline: none;
        border-color: #00ccff;
        box-shadow: 0 0 5px rgba(0, 204, 255, 0.5);
      }

      .btn {
        display: inline-block;
        background-color: #0066cc;
        color: white;
        font-size: 1.1rem;
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn:hover {
        background-color: #00ff66;
        color: #111;
      }

      .btn:disabled {
        background-color: #555;
        cursor: not-allowed;
      }

      /* Card Layout */
      .card {
        background-color: #222;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        border-left: 4px solid #0066cc;
      }

      .card h3 {
        margin-top: 0;
        border-bottom: 1px solid #333;
        padding-bottom: 10px;
      }

      .card-content {
        margin-top: 15px;
      }

      /* Form Layout */
      .form-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      /* Lesson Output Styles */
      .lesson-container {
        background-color: #222;
        border-radius: 8px;
        padding: 30px;
        margin-top: 40px;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        border-left: 5px solid #00ccff;
        display: none;
      }

      .lesson-header {
        margin-bottom: 25px;
        border-bottom: 1px solid #333;
        padding-bottom: 15px;
      }

      .lesson-title {
        font-size: 1.8rem;
        color: #00ff66;
        margin-bottom: 10px;
      }

      .lesson-metadata {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        font-size: 1rem;
      }

      .metadata-item {
        background-color: #333;
        padding: 8px 15px;
        border-radius: 20px;
      }

      .lesson-section {
        margin-bottom: 30px;
      }

      .section-title {
        font-size: 1.4rem;
        color: #00ccff;
        margin-bottom: 15px;
        border-bottom: 1px solid #333;
        padding-bottom: 8px;
      }

      .visual-item,
      .activity-item,
      .assessment-item,
      .resource-item {
        background-color: #333;
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 15px;
      }

      .activity-item {
        border-left: 4px solid #00ff66;
      }

      .assessment-item {
        border-left: 4px solid #ff9900;
      }

      /* Lesson Controls */
      .lesson-controls {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #333;
      }

      /* Help Panel */
      .help-panel {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 100;
      }

      .help-toggle {
        background-color: #00ccff;
        color: #111;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.8rem;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      }

      .help-content {
        position: absolute;
        bottom: 80px;
        right: 0;
        width: 350px;
        background-color: #222;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        transform: scale(0);
        transform-origin: bottom right;
        transition: transform 0.3s ease;
      }

      .help-content.active {
        transform: scale(1);
      }

      .help-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        border-bottom: 1px solid #333;
        padding-bottom: 10px;
      }

      .help-close {
        font-size: 1.5rem;
        cursor: pointer;
        color: #666;
      }

      .help-message {
        margin-bottom: 15px;
      }

      .help-option {
        background-color: #333;
        padding: 12px 15px;
        border-radius: 6px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      .help-option:hover {
        background-color: #444;
      }

      /* Reading Guide */
      .reading-guide {
        height: 30px;
        background-color: rgba(52, 152, 219, 0.2);
        border-radius: 4px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      /* API Selection */
      .api-selection {
        display: flex;
        gap: 15px;
        margin-top: 10px;
      }

      .api-option {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
      }

      .api-option input {
        margin: 0;
      }

      /* Spinner */
      .spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Print Styles */
      @media print {
        body {
          background-color: white;
          color: black;
        }

        .header,
        .form-area,
        .help-panel,
        .lesson-controls {
          display: none;
        }

        .lesson-container {
          display: block !important;
          border: none;
          box-shadow: none;
          padding: 0;
        }

        .metadata-item {
          border: 1px solid #ccc;
          background: none;
        }
      }

      /* Responsive Styles */
      @media (max-width: 768px) {
        .form-layout {
          grid-template-columns: 1fr;
        }

        .lesson-metadata {
          flex-direction: column;
          gap: 10px;
        }
      }

      /* Personalization Section Styles */
      .personalization-section {
        background-color: #1a2636;
        border-radius: 8px;
        padding: 20px;
        margin-top: 25px;
        border-left: 4px solid #00ff66;
      }

      .personalization-title {
        color: #00ff66;
        font-size: 1.4rem;
        margin-bottom: 15px;
      }

      .personalization-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 15px;
      }

      @media (max-width: 768px) {
        .personalization-grid {
          grid-template-columns: 1fr;
        }
      }

      .info-icon {
        display: inline-block;
        width: 20px;
        height: 20px;
        background-color: #00ccff;
        color: #111;
        border-radius: 50%;
        text-align: center;
        line-height: 20px;
        margin-left: 5px;
        font-size: 0.9rem;
        cursor: help;
      }

      .tooltip {
        position: relative;
        display: inline-block;
      }

      .tooltip .tooltiptext {
        visibility: hidden;
        width: 250px;
        background-color: #333;
        color: #fff;
        text-align: left;
        border-radius: 6px;
        padding: 10px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        margin-left: -125px;
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 0.9rem;
        line-height: 1.4;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <img
          src="/assets/superhero-school-logo.png"
          alt="Neurodivergent Superhero School Logo"
          class="logo"
          onerror="this.src='/assets/default-logo.png'; this.onerror=null;"
        />
        <h1>Personalized Dyslexia Curriculum Generator</h1>
        <p class="dyslexia-friendly-text">
          Create customized, dyslexia-friendly educational content aligned with state standards
        </p>
      </div>

      <div class="main-content">
        <div class="form-area">
          <div class="card">
            <h3>Generate Learning Materials</h3>
            <p class="dyslexia-friendly-text">
              Select your options below to create personalized, dyslexia-friendly curriculum
              materials that follow educational standards.
            </p>

            <form id="curriculum-form">
              <div class="form-layout">
                <div class="form-group">
                  <label for="subject">Subject Area</label>
                  <select id="subject" name="subject" required>
                    <option value="">Select a subject...</option>
                    <option value="english">English Language Arts</option>
                    <option value="math">Mathematics</option>
                    <option value="science">Science</option>
                    <option value="social-studies">Social Studies</option>
                    <option value="history">History</option>
                    <option value="art">Art</option>
                    <option value="music">Music</option>
                    <option value="physical-education">Physical Education</option>
                    <option value="technology">Technology</option>
                    <option value="foreign-language">Foreign Language</option>
                    <option value="literature">Literature</option>
                    <option value="writing">Writing</option>
                    <option value="reading">Reading</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="grade">Grade Level</label>
                  <select id="grade" name="grade" required>
                    <option value="">Select a grade...</option>
                    <option value="k">Kindergarten</option>
                    <option value="1">1st Grade</option>
                    <option value="2">2nd Grade</option>
                    <option value="3">3rd Grade</option>
                    <option value="4">4th Grade</option>
                    <option value="5">5th Grade</option>
                    <option value="6">6th Grade</option>
                    <option value="7">7th Grade</option>
                    <option value="8">8th Grade</option>
                    <option value="9">9th Grade</option>
                    <option value="10">10th Grade</option>
                    <option value="11">11th Grade</option>
                    <option value="12">12th Grade</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="format">Learning Format</label>
                  <select id="format" name="format" required>
                    <option value="">Select a format...</option>
                    <option value="text">Text-based (Dyslexia-Friendly)</option>
                    <option value="audio">Audio Script</option>
                    <option value="visual">Visual Guide with Diagrams</option>
                    <option value="game">Game-Based Learning</option>
                    <option value="chat">AI Chat-Based Learning</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="state">Educational Standards</label>
                  <select id="state" name="state">
                    <option value="general">General Standards</option>
                    <option value="alabama" selected>Alabama State Standards</option>
                    <option value="common-core">Common Core</option>
                    <option value="ngss">Next Generation Science Standards</option>
                  </select>
                </div>

                <div class="form-group" style="grid-column: 1 / span 2">
                  <label for="topic">Specific Topic (optional)</label>
                  <input
                    type="text"
                    id="topic"
                    name="topic"
                    placeholder="e.g., Fractions, The Water Cycle, Shakespeare, etc."
                  />
                </div>
              </div>

              <!-- Personalization Section -->
              <div class="personalization-section">
                <h3 class="personalization-title">Personalization Options</h3>
                <p class="dyslexia-friendly-text">
                  Customize the learning materials to better fit your student's learning preferences
                  and strengths.
                </p>

                <div class="personalization-grid">
                  <div class="form-group">
                    <label for="learning-style">
                      Learning Style Preference
                      <span class="tooltip">
                        <span class="info-icon">?</span>
                        <span class="tooltiptext"
                          >Choose the primary learning modality that works best for your student.
                          This affects how information is presented.</span
                        >
                      </span>
                    </label>
                    <select id="learning-style" name="learning-style">
                      <option value="multimodal">Balanced Multi-Modal</option>
                      <option value="visual">Visual (Pictures & Diagrams)</option>
                      <option value="auditory">Auditory (Sounds & Spoken Word)</option>
                      <option value="kinesthetic">Kinesthetic (Movement & Hands-on)</option>
                      <option value="reading-writing">Reading & Writing</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="reading-level">
                      Reading Level Adjustment
                      <span class="tooltip">
                        <span class="info-icon">?</span>
                        <span class="tooltiptext"
                          >Adjust the reading level to accommodate different reading abilities while
                          maintaining grade-level content.</span
                        >
                      </span>
                    </label>
                    <select id="reading-level" name="reading-level">
                      <option value="grade-level">Grade Level (Standard)</option>
                      <option value="simplified">Simplified Language</option>
                      <option value="advanced">Advanced Vocabulary</option>
                      <option value="highly-visual">Highly Visual (Minimal Text)</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="strength-area">
                      Student Strength Area
                      <span class="tooltip">
                        <span class="info-icon">?</span>
                        <span class="tooltiptext"
                          >Leverage your student's cognitive strengths to improve engagement and
                          learning outcomes.</span
                        >
                      </span>
                    </label>
                    <select id="strength-area" name="strength-area">
                      <option value="none">No Specific Focus</option>
                      <option value="verbal">Verbal Reasoning</option>
                      <option value="spatial">Spatial Reasoning</option>
                      <option value="logical">Logical Reasoning</option>
                      <option value="creative">Creative Thinking</option>
                      <option value="social">Social Intelligence</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- API Selection -->
              <div class="form-group" style="margin-top: 20px">
                <label>AI Model</label>
                <div class="api-selection">
                  <label class="api-option">
                    <input type="radio" name="api" value="anthropic" checked />
                    <span>Claude (Anthropic)</span>
                  </label>
                  <label class="api-option">
                    <input type="radio" name="api" value="perplexity" />
                    <span>Perplexity AI</span>
                  </label>
                </div>
              </div>

              <div style="text-align: center; margin-top: 25px">
                <button type="submit" class="btn" id="generate-btn">Generate Curriculum</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Lesson Output Container -->
        <div class="lesson-container" id="lesson-container">
          <div class="lesson-header">
            <h2 class="lesson-title" id="lesson-title">Lesson Title</h2>
            <div class="lesson-metadata">
              <div class="metadata-item" id="lesson-grade">Grade Level</div>
              <div class="metadata-item" id="lesson-subject">Subject</div>
              <div class="metadata-item" id="lesson-format">Format</div>
            </div>
          </div>

          <div class="lesson-section">
            <h3 class="section-title">Learning Objectives</h3>
            <ul class="dyslexia-friendly-text" id="lesson-objectives-list">
              <!-- Objectives will be inserted here -->
            </ul>
          </div>

          <div class="lesson-section">
            <h3 class="section-title">Lesson Content</h3>
            <div class="reading-guide" onclick="handleReadingGuide(event)"></div>
            <div class="dyslexia-friendly-text" id="lesson-content">
              <!-- Content will be inserted here -->
            </div>
          </div>

          <div class="lesson-section">
            <h3 class="section-title">Visual Supports</h3>
            <div id="lesson-visuals">
              <!-- Visuals will be inserted here -->
            </div>
          </div>

          <div class="lesson-section">
            <h3 class="section-title">Learning Activities</h3>
            <div id="lesson-activities">
              <!-- Activities will be inserted here -->
            </div>
          </div>

          <div class="lesson-section">
            <h3 class="section-title">Assessment</h3>
            <div id="lesson-assessment">
              <!-- Assessment items will be inserted here -->
            </div>
          </div>

          <div class="lesson-section">
            <h3 class="section-title">Additional Resources</h3>
            <div id="lesson-resources">
              <!-- Resources will be inserted here -->
            </div>
          </div>

          <div class="lesson-controls">
            <button class="btn" onclick="printLesson()">Print Lesson</button>
            <button class="btn" onclick="saveAsPDF()">Save as PDF</button>
            <button class="btn" onclick="customizeLesson()">Customize</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Help Panel -->
    <div class="help-panel">
      <div class="help-toggle" onclick="toggleHelpPanel()">?</div>
      <div class="help-content" id="help-content">
        <div class="help-header">
          <h3>How can I help?</h3>
          <div class="help-close" onclick="closeHelpPanel()">×</div>
        </div>
        <div class="help-message">
          <p>
            I'm Stella, your learning companion! What would you like to know about the curriculum
            generator?
          </p>
        </div>
        <div class="help-options">
          <div class="help-option dyslexia-friendly-text" onclick="handleHelpOptionClick(event)">
            What makes this content dyslexia-friendly?
          </div>
          <div class="help-option dyslexia-friendly-text" onclick="handleHelpOptionClick(event)">
            Which format is best for my student?
          </div>
          <div class="help-option dyslexia-friendly-text" onclick="handleHelpOptionClick(event)">
            Can I edit the generated lesson?
          </div>
          <div class="help-option dyslexia-friendly-text" onclick="handleHelpOptionClick(event)">
            What's the difference between AI models?
          </div>
        </div>
      </div>
    </div>

    <script>
      // DOM Elements
      const curriculumForm = document.getElementById('curriculum-form');
      const subjectSelect = document.getElementById('subject');
      const gradeSelect = document.getElementById('grade');
      const formatSelect = document.getElementById('format');
      const stateSelect = document.getElementById('state');
      const topicInput = document.getElementById('topic');
      const generateBtn = document.getElementById('generate-btn');

      const lessonContainer = document.getElementById('lesson-container');
      const lessonTitle = document.getElementById('lesson-title');
      const lessonGrade = document.getElementById('lesson-grade');
      const lessonSubject = document.getElementById('lesson-subject');
      const lessonFormat = document.getElementById('lesson-format');
      const lessonObjectivesList = document.getElementById('lesson-objectives-list');
      const lessonContentText = document.getElementById('lesson-content');
      const lessonVisualsContainer = document.getElementById('lesson-visuals');
      const lessonActivitiesContainer = document.getElementById('lesson-activities');
      const lessonAssessmentContainer = document.getElementById('lesson-assessment');
      const lessonResourcesContainer = document.getElementById('lesson-resources');

      const helpContent = document.getElementById('help-content');

      // Event Listeners
      curriculumForm.addEventListener('submit', handleFormSubmit);

      // Populate topic suggestions based on subject and grade
      subjectSelect.addEventListener('change', updateTopicSuggestions);
      gradeSelect.addEventListener('change', updateTopicSuggestions);

      // Add speech synthesis to reading elements
      document.addEventListener('DOMContentLoaded', function() {
        // Add text-to-speech buttons to sections
        document.querySelectorAll('.lesson-section').forEach(section => {
          const speakBtn = document.createElement('button');
          speakBtn.innerHTML = '🔊';
          speakBtn.className = 'speak-btn';
          speakBtn.style.float = 'right';
          speakBtn.style.background = 'none';
          speakBtn.style.border = 'none';
          speakBtn.style.fontSize = '1.2rem';
          speakBtn.style.cursor = 'pointer';
          speakBtn.addEventListener('click', handleTextToSpeech);
          section.querySelector('.section-title').appendChild(speakBtn);
        });
      });

      /**
       * Update topic suggestions based on selected subject and grade
       */
      function updateTopicSuggestions() {
        const subject = subjectSelect.value;
        const grade = gradeSelect.value;

        if (!subject || !grade) return;

        // Clear the current suggestions
        topicInput.placeholder = 'Loading suggestions...';

        // Sample topic suggestions
        const topicSuggestions = getTopicSuggestions(subject, grade);

        // Update the placeholder with suggestions
        topicInput.placeholder = `e.g., ${topicSuggestions.join(', ')}`;
      }

      /**
       * Get topic suggestions based on subject and grade
       */
      function getTopicSuggestions(subject, grade) {
        // Sample mapping of subjects to topics by grade level
        const topicMap = {
          english: {
            k: ['Alphabet Recognition', 'Phonics Basics', 'Simple Storytelling'],
            1: ['Sight Words', 'Reading Fluency', 'Story Elements'],
            2: ['Reading Comprehension', 'Grammar Basics', 'Writing Complete Sentences'],
            3: ['Paragraph Writing', 'Main Idea & Details', 'Fiction vs. Non-fiction'],
            4: ['Narrative Writing', 'Context Clues', 'Character Analysis'],
            5: ['Informational Writing', 'Literary Devices', 'Text Structure'],
            6: ['Argumentative Writing', 'Greek & Latin Roots', 'Citing Evidence'],
            7: ['Research Writing', 'Analyzing Theme', 'Figurative Language'],
            8: ['Literary Analysis', 'Active vs. Passive Voice', 'Media Literacy'],
            9: ['Shakespeare Introduction', 'Rhetorical Analysis', 'Poetry Elements'],
            10: ['World Literature', 'Persuasive Techniques', 'Written Arguments'],
            11: ['American Literature', 'Complex Syntax', 'Research Methods'],
            12: ['British Literature', 'Critical Theory', 'College-Level Writing']
          },
          math: {
            k: ['Number Recognition', 'Counting to 20', 'Basic Shapes'],
            1: ['Addition to 20', 'Subtraction to 20', 'Time & Money'],
            2: ['Addition to 100', 'Subtraction to 100', 'Measurement'],
            3: ['Multiplication Basics', 'Division Basics', 'Fractions Introduction'],
            4: ['Multi-Digit Multiplication', 'Long Division', 'Equivalent Fractions'],
            5: ['Decimals', 'Fraction Operations', 'Volume & Area'],
            6: ['Ratios & Proportions', 'Intro to Algebra', 'Geometric Formulas'],
            7: ['Linear Equations', 'Probability', 'Geometric Constructions'],
            8: ['Functions', 'Systems of Equations', 'Pythagorean Theorem'],
            9: ['Linear Algebra', 'Quadratic Functions', 'Coordinate Geometry'],
            10: ['Quadratic Equations', 'Trigonometry Basics', 'Probability & Statistics'],
            11: ['Advanced Functions', 'Trigonometric Functions', 'Limits & Derivatives'],
            12: ['Calculus Concepts', 'Statistics & Data Analysis', 'Mathematical Modeling']
          },
          science: {
            k: ['Five Senses', 'Weather Patterns', 'Plant & Animal Basics'],
            1: ['Living vs. Non-living', 'States of Matter', 'Seasonal Changes'],
            2: ['Life Cycles', 'Habitats', 'Simple Machines'],
            3: ['Earth's Systems', 'Forces & Motion', 'Animal Adaptations'],
            4: ['Energy Forms', 'Weather & Climate', 'Human Body Systems'],
            5: ['Matter Properties', 'Earth's Spheres', 'Ecosystems'],
            6: ['Cells & Organisms', 'Earth's History', 'Energy Transfer'],
            7: ['Genetics & Heredity', 'Plate Tectonics', 'Chemical Reactions'],
            8: ['Newton's Laws', 'Waves & Sound', 'Human Impact on Environment'],
            9: ['Atomic Structure', 'Cellular Processes', 'Environmental Science'],
            10: ['Chemistry Fundamentals', 'Biology Fundamentals', 'Physics Mechanics'],
            11: ['Organic Chemistry', 'Genetics & Evolution', 'Thermodynamics'],
            12: ['Biochemistry', 'Advanced Physics', 'Environmental Systems']
          }
        };

        // Default suggestions if subject or grade not in map
        const defaultSuggestions = ['Topic 1', 'Topic 2', 'Topic 3'];

        // Get subject topics for grade, or default to general suggestions
        if (topicMap[subject] && topicMap[subject][grade]) {
          return topicMap[subject][grade];
        } else if (subject === 'history') {
          return ['Ancient Civilizations', 'World Wars', 'Civil Rights Movement'];
        } else if (subject === 'social-studies') {
          return ['Community Helpers', 'Geography', 'Government'];
        } else {
          return defaultSuggestions;
        }
      }

      /**
       * Handle form submission to generate curriculum
       */
      async function handleFormSubmit(event) {
        event.preventDefault();

        const subject = subjectSelect.value;
        const grade = gradeSelect.value;
        const format = formatSelect.value;
        const state = stateSelect.value;
        const topic = topicInput.value || `${subjectSelect.options[subjectSelect.selectedIndex].text} for ${gradeSelect.options[gradeSelect.selectedIndex].text}`;
        const api = document.querySelector('input[name="api"]:checked').value;

        // Get personalization parameters
        const learningStyle = document.getElementById('learning-style').value;
        const readingLevel = document.getElementById('reading-level').value;
        const strengthArea = document.getElementById('strength-area').value;

        if (!subject || !grade || !format) {
          alert('Please select a subject, grade level, and learning format.');
          return;
        }

        // Show loading state
        generateBtn.disabled = true;
        generateBtn.innerHTML = '<span class="spinner"></span> Generating...';

        try {
          // Create the request body with form data
          const requestData = {
            subject,
            grade,
            format,
            state,
            topic,
            api,
            personalization: {
              learningStyle,
              readingLevel,
              strengthArea
            }
          };

          // Make the actual API call to our backend
          const response = await fetch('/api/dyslexia-curriculum', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestData)
          });

          // Check if the request was successful
          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to generate curriculum');
          }

          // Get the curriculum data
          const lessonData = await response.json();

          // Display the lesson data
          displayLessonData(lessonData);

          // Reset form button
          generateBtn.disabled = false;
          generateBtn.innerHTML = 'Generate Curriculum';

          // Scroll to the lesson container
          lessonContainer.scrollIntoView({ behavior: 'smooth' });
        } catch (error) {
          console.error('Error generating curriculum:', error);
          alert(`Error: ${error.message || 'Failed to generate curriculum. Please try again.'}`);

          // Reset form button
          generateBtn.disabled = false;
          generateBtn.innerHTML = 'Generate Curriculum';
        }
      }

      /**
       * Display the generated lesson data
       */
      function displayLessonData(data) {
        // Show the lesson container
        lessonContainer.style.display = 'block';

        // Set the lesson title and metadata
        lessonTitle.textContent = data.title;
        lessonGrade.textContent = data.grade_level;
        lessonSubject.textContent = data.subject;
        lessonFormat.textContent = getFormatDisplayText(data.format);

        // Set learning objectives
        lessonObjectivesList.innerHTML = '';
        data.learning_objectives.forEach(objective => {
          const li = document.createElement('li');
          li.textContent = objective;
          lessonObjectivesList.appendChild(li);
        });

        // Set lesson content
        lessonContentText.innerHTML = formatContentForDyslexia(data.content);

        // Set visuals
        lessonVisualsContainer.innerHTML = '';
        data.visuals.forEach(visual => {
          const visualItem = document.createElement('div');
          visualItem.className = 'visual-item dyslexia-friendly-text';
          visualItem.textContent = visual;
          lessonVisualsContainer.appendChild(visualItem);
        });

        // Set activities
        lessonActivitiesContainer.innerHTML = '';
        data.activities.forEach(activity => {
          const activityItem = document.createElement('div');
          activityItem.className = 'activity-item dyslexia-friendly-text';
          activityItem.textContent = activity;
          lessonActivitiesContainer.appendChild(activityItem);
        });

        // Set assessment items
        lessonAssessmentContainer.innerHTML = '';
        data.assessment.forEach(assessment => {
          const assessmentItem = document.createElement('div');
          assessmentItem.className = 'assessment-item dyslexia-friendly-text';
          assessmentItem.textContent = assessment;
          lessonAssessmentContainer.appendChild(assessmentItem);
        });

        // Set additional resources
        lessonResourcesContainer.innerHTML = '';
        data.additional_resources.forEach(resource => {
          const resourceItem = document.createElement('div');
          resourceItem.className = 'resource-item';
          resourceItem.textContent = resource;
          lessonResourcesContainer.appendChild(resourceItem);
        });
      }

      /**
       * Format the content text to be more dyslexia-friendly
       */
      function formatContentForDyslexia(content) {
        // Replace paragraphs with proper spacing
        let formatted = content.replace(/\n\n/g, '</p><p>');

        // Add paragraph tags if not already present
        if (!formatted.startsWith('<p>')) {
          formatted = '<p>' + formatted;
        }
        if (!formatted.endsWith('</p>')) {
          formatted = formatted + '</p>';
        }

        // Replace bullet points with styled lists
        formatted = formatted.replace(/\n\s*[-•*]\s+/g, '</p><p class="bullet-point">• ');

        // Highlight key terms
        const keyTerms = ['important', 'remember', 'key', 'note', 'essential', 'focus', 'critical'];
        keyTerms.forEach(term => {
          const regex = new RegExp(`\\b${term}\\b`, 'gi');
          formatted = formatted.replace(regex, match => `<strong>${match}</strong>`);
        });

        return formatted;
      }

      /**
       * Get display text for the format
       */
      function getFormatDisplayText(format) {
        const formatMap = {
          'text': 'Text-based (Dyslexia-Friendly)',
          'audio': 'Audio Script',
          'visual': 'Visual Guide with Diagrams',
          'game': 'Game-Based Learning',
          'chat': 'AI Chat-Based Learning'
        };

        return formatMap[format] || format;
      }

      /**
       * Print the lesson
       */
      function printLesson() {
        window.print();
      }

      /**
       * Save the lesson as PDF
       */
      function saveAsPDF() {
        alert('In a production environment, this would save the current lesson as a PDF file.');
        // In a real implementation, we would use a PDF generation library
      }

      /**
       * Open the customize lesson interface
       */
      function customizeLesson() {
        alert('In a production environment, this would open an editor to customize the lesson content.');
        // In a real implementation, we would show an editor interface
      }

      /**
       * Toggle the help panel
       */
      function toggleHelpPanel() {
        helpContent.classList.toggle('active');
      }

      /**
       * Close the help panel
       */
      function closeHelpPanel() {
        helpContent.classList.remove('active');
      }

      /**
       * Handle help option click
       */
      function handleHelpOptionClick(event) {
        const optionText = event.target.textContent;
        let responseText = '';

        // Provide different responses based on the option clicked
        if (optionText.includes('dyslexia-friendly')) {
          responseText = "Dyslexia-friendly content uses specific formatting techniques: larger spacing between lines, short paragraphs, bullet points instead of dense text, clear headings, simple sans-serif fonts, high contrast colors, and visual aids supporting text content. Our generator implements these best practices automatically to make learning materials more accessible.";
        } else if (optionText.includes('best format')) {
          responseText = "The best format depends on your student's learning preferences: Text-based format uses dyslexia-friendly formatting with bullet points and clear structure. Audio format creates scripts optimized for listening. Visual guides focus on diagrams and visual learning. Game-based format creates interactive activities. Chat-based simulates a tutoring conversation. For most students, a multi-sensory approach combining formats works best!";
        } else if (optionText.includes('edit the generated')) {
          responseText = "Yes! After generating content, click the 'Customize' button to open our editor. You can modify any part of the lesson while maintaining dyslexia-friendly formatting. You can also save the content as a PDF or print it directly. In the future, we'll add the ability to save lessons to your library and share them with other teachers.";
        } else if (optionText.includes('difference between AI')) {
          responseText = "We offer two powerful AI models: Claude (by Anthropic) excels at educational content with nuanced understanding of learning needs and produces content with excellent formatting and structure. Perplexity AI has broader knowledge coverage for specialized subjects and sometimes generates more creative activities. Try both to see which works best for your specific needs!";
        }

        // Update the help message
        document.querySelector('.help-message').innerHTML = `<p>${responseText}</p>`;

        // Update the help options
        const helpOptionsContainer = document.querySelector('.help-options');
        helpOptionsContainer.innerHTML = `
          <div class="help-option dyslexia-friendly-text">How can I save lessons for later?</div>
          <div class="help-option dyslexia-friendly-text">Can I see some example lessons?</div>
          <div class="help-option dyslexia-friendly-text">Will this work for all dyslexic students?</div>
          <div class="help-option dyslexia-friendly-text">I have a different question</div>
        `;

        // Add event listeners to the new help options
        document.querySelectorAll('.help-option').forEach(option => {
          option.addEventListener('click', handleSecondaryHelpOptionClick);
        });
      }

      /**
       * Handle secondary help option click
       */
      function handleSecondaryHelpOptionClick(event) {
        const optionText = event.target.textContent;
        let responseText = '';

        // Provide different responses based on the option clicked
        if (optionText.includes('save lessons')) {
          responseText = "Currently in our demo version, you can save lessons as PDFs or print them. In the full version coming next month, you'll have a personal lesson library where you can save, organize, and retrieve all your generated content. You'll also be able to share lessons with colleagues and track which lessons were most effective.";
        } else if (optionText.includes('example lessons')) {
          responseText = "Yes! Click the 'Generate Curriculum' button without making any selections, and I'll show you some featured example lessons across different subjects and grade levels. These examples showcase the different formatting options and can help you get ideas for your own custom lessons.";
        } else if (optionText.includes('all dyslexic students')) {
          responseText = "While our curriculum generator follows research-based best practices for dyslexia support, every student has unique needs. The content is designed to be a starting point that you can customize. Some students may need more visual supports, others more audio elements. The personalization tools let you tailor the generated content to meet your specific student's needs.";
        } else if (optionText.includes('different question')) {
          responseText = "Feel free to ask me anything about the curriculum generator or dyslexia-friendly teaching approaches! I'm here to help you create the most effective materials for your students. You can also email support@shotzios.com for more detailed assistance.";
        }

        // Update the help message
        document.querySelector('.help-message').innerHTML = `<p>${responseText}</p>`;
      }

      /**
       * Handle text-to-speech functionality
       */
      function handleTextToSpeech(event) {
        // Get the parent section
        const section = event.target.closest('.lesson-section');
        // Get the text content
        const textContent = section.querySelector('.dyslexia-friendly-text, ul, div:not(.section-title):not(.reading-guide)').textContent.trim();

        // Use the browser's speech synthesis API
        if ('speechSynthesis' in window) {
          const speech = new SpeechSynthesisUtterance();
          speech.text = textContent;
          speech.rate = 0.9; // Slightly slower rate for dyslexic readers
          speech.pitch = 1;
          window.speechSynthesis.speak(speech);
        } else {
          alert('Sorry, your browser does not support text-to-speech!');
        }
      }

      /**
       * Handle reading guide functionality
       */
      function handleReadingGuide(event) {
        const guide = event.target;
        guide.style.backgroundColor = 'rgba(52, 152, 219, 0.4)';
        setTimeout(() => {
          guide.style.backgroundColor = 'rgba(52, 152, 219, 0.2)';
        }, 1000);
      }
    </script>
  </body>
</html>
