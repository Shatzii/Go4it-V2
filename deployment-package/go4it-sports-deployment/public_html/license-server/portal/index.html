
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Go4It Sports - License Portal</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f5f5f5; }
    .container { max-width: 800px; margin: 0 auto; padding: 20px; }
    .header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
    .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
    .btn { background: #007AFF; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; }
    .btn:hover { background: #0056CC; }
    .status-active { color: #28a745; font-weight: bold; }
    .status-expired { color: #dc3545; font-weight: bold; }
    .feature-list { list-style: none; }
    .feature-list li { padding: 8px 0; border-bottom: 1px solid #eee; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Go4It Sports License Portal</h1>
      <p>Manage your self-hosted Go4It Sports subscription</p>
    </div>
    
    <div class="card" id="loginCard">
      <h2>Login</h2>
      <form id="loginForm">
        <div style="margin-bottom: 15px;">
          <label for="email">Email:</label>
          <input type="email" id="email" required style="width: 100%; padding: 8px; margin-top: 5px;">
        </div>
        <div style="margin-bottom: 15px;">
          <label for="password">Password:</label>
          <input type="password" id="password" required style="width: 100%; padding: 8px; margin-top: 5px;">
        </div>
        <button type="submit" class="btn">Login</button>
      </form>
    </div>
    
    <div class="card" id="dashboardCard" style="display: none;">
      <h2>License Information</h2>
      <div id="licenseInfo"></div>
      
      <h3 style="margin-top: 30px;">Available Features</h3>
      <ul id="featureList" class="feature-list"></ul>
      
      <div style="margin-top: 30px;">
        <button class="btn" onclick="renewSubscription()">Renew Subscription</button>
        <button class="btn" onclick="upgradeSubscription()" style="margin-left: 10px;">Upgrade</button>
        <button class="btn" onclick="logout()" style="background: #666; margin-left: 10px;">Logout</button>
      </div>
    </div>
  </div>
  
  <script>
    let authToken = localStorage.getItem('go4it_auth_token');
    
    if (authToken) {
      showDashboard();
    }
    
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      try {
        const response = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        
        if (response.ok) {
          const data = await response.json();
          authToken = data.token;
          localStorage.setItem('go4it_auth_token', authToken);
          showDashboard();
        } else {
          alert('Login failed');
        }
      } catch (error) {
        alert('Login error: ' + error.message);
      }
    });
    
    async function showDashboard() {
      document.getElementById('loginCard').style.display = 'none';
      document.getElementById('dashboardCard').style.display = 'block';
      
      try {
        const response = await fetch('/api/customer/license', {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (response.ok) {
          const license = await response.json();
          displayLicenseInfo(license);
        } else {
          alert('Failed to load license information');
        }
      } catch (error) {
        alert('Error loading dashboard: ' + error.message);
      }
    }
    
    function displayLicenseInfo(license) {
      const statusClass = license.status === 'active' ? 'status-active' : 'status-expired';
      const expiresAt = new Date(license.expiresAt).toLocaleDateString();
      
      document.getElementById('licenseInfo').innerHTML = `
        <p><strong>License Key:</strong> ${license.licenseKey}</p>
        <p><strong>Subscription Tier:</strong> ${license.tier.charAt(0).toUpperCase() + license.tier.slice(1)}</p>
        <p><strong>Status:</strong> <span class="${statusClass}">${license.status.toUpperCase()}</span></p>
        <p><strong>Expires:</strong> ${expiresAt}</p>
        <p><strong>Max Athletes:</strong> ${license.maxAthletes === 9999 ? 'Unlimited' : license.maxAthletes}</p>
      `;
      
      const featureList = document.getElementById('featureList');
      featureList.innerHTML = '';
      license.features.forEach(feature => {
        const li = document.createElement('li');
        li.textContent = feature.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        featureList.appendChild(li);
      });
    }
    
    function renewSubscription() {
      window.open('https://go4itsports.com/renew', '_blank');
    }
    
    function upgradeSubscription() {
      window.open('https://go4itsports.com/upgrade', '_blank');
    }
    
    function logout() {
      localStorage.removeItem('go4it_auth_token');
      location.reload();
    }
  </script>
</body>
</html>
