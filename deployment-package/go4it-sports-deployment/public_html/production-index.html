<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Go4It Sports Platform - Performance platform for neurodivergent student athletes">
  <meta name="theme-color" content="#0066cc">
  <base href="https://go4itsports.org">
  
  <!-- Primary Meta Tags -->
  <title>Go4It Sports Platform</title>
  <meta name="title" content="Go4It Sports Platform">
  <meta name="description" content="Advanced sports performance platform for neurodivergent student athletes with GAR scoring and AI-powered coaching">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://go4itsports.org/">
  <meta property="og:title" content="Go4It Sports Platform">
  <meta property="og:description" content="Advanced sports performance platform for neurodivergent student athletes with GAR scoring and AI-powered coaching">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://go4itsports.org/">
  <meta property="twitter:title" content="Go4It Sports Platform">
  <meta property="twitter:description" content="Advanced sports performance platform for neurodivergent student athletes with GAR scoring and AI-powered coaching">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/assets/favicon.png">
  
  <!-- Preload critical assets -->
  <link rel="preload" href="/assets/fonts/main.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/assets/css/main.css" as="style">
  <link rel="preload" href="/assets/js/main.js" as="script" type="module">
  
  <!-- Styles -->
  <link rel="stylesheet" href="/assets/css/main.css">
  
  <!-- Load deferred assets -->
  <script>
    // Feature detection
    const features = {
      webp: false,
      grid: false,
      flexGap: false,
      touchDevice: false,
      passiveEvents: false
    };
    
    // Check for WebP support
    const webpCheck = new Image();
    webpCheck.onload = function() { features.webp = true; document.documentElement.classList.add('webp'); };
    webpCheck.onerror = function() { features.webp = false; };
    webpCheck.src = 'data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==';
    
    // Check for CSS Grid support
    features.grid = CSS.supports('display', 'grid');
    if (features.grid) document.documentElement.classList.add('grid');
    
    // Check for flex gap support
    features.flexGap = CSS.supports('gap', '1px');
    if (features.flexGap) document.documentElement.classList.add('flex-gap');
    
    // Check for touch device
    features.touchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
    if (features.touchDevice) document.documentElement.classList.add('touch-device');
    
    // Check for passive event support
    try {
      const opts = Object.defineProperty({}, 'passive', {
        get: function() {
          features.passiveEvents = true;
          return true;
        }
      });
      window.addEventListener('test', null, opts);
      window.removeEventListener('test', null, opts);
    } catch (e) {
      features.passiveEvents = false;
    }
    
    // Log detected features
    console.log('Browser compatibility features detected:', features);
    
    // Detect device type
    const deviceType = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ? 'mobile' : 'desktop';
    features.deviceType = deviceType;
    document.documentElement.classList.add(deviceType);
    
    // Preload AI modules
    window.GO4IT_INITIALIZED = false;
    window.GO4IT_CONFIG = {
      apiBase: '/api',
      wsUrl: (window.location.protocol === 'https:' ? 'wss:' : 'ws:') + '//' + window.location.host + '/ws',
      assetBase: '/assets',
      uploadBase: '/uploads',
      version: '1.0.1',
      environment: 'production',
      features: features
    };
  </script>
</head>
<body>
  <!-- App root element -->
  <div id="root">
    <!-- Initial loading state -->
    <div class="app-loading">
      <div class="app-loading-logo">
        <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="60" cy="60" r="56" stroke="#0066cc" stroke-width="8"/>
          <path d="M40,40 L80,80" stroke="#00aaff" stroke-width="10" stroke-linecap="round"/>
          <path d="M40,80 L80,40" stroke="#00aaff" stroke-width="10" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="app-loading-text">Loading Go4It Sports...</div>
    </div>
  </div>
  
  <!-- Error handling for older browsers -->
  <noscript>
    <div class="browser-warning">
      <h1>JavaScript Required</h1>
      <p>Go4It Sports requires JavaScript to function. Please enable JavaScript in your browser settings and reload the page.</p>
    </div>
  </noscript>
  
  <!-- Toast container for notifications -->
  <div id="toast-container" aria-live="polite" aria-atomic="true"></div>
  
  <!-- Core JavaScript -->
  <script type="module" src="/assets/js/main.js"></script>
  
  <!-- AI Module scripts with proper type="module" -->
  <script type="module" src="/js/agent.js"></script>
  <script type="module" src="/js/ai_assist.js"></script>
  <script type="module" src="/js/upload.js"></script>
  <script type="module" src="/js/voice.js"></script>
  
  <!-- Initialization -->
  <script type="module">
    // Import AI loader
    import aiLoader from '/js/ai-loader.js';
    
    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize AI modules
      aiLoader.init(window.GO4IT_CONFIG);
      
      // Mark app as initialized
      window.GO4IT_INITIALIZED = true;
      document.documentElement.classList.add('app-ready');
      
      // Check server status
      fetch('/api/health')
        .then(response => response.json())
        .then(data => {
          console.log('Server status:', data);
          document.dispatchEvent(new CustomEvent('server-ready', { detail: data }));
        })
        .catch(error => {
          console.error('Server connection error:', error);
          document.dispatchEvent(new CustomEvent('server-error', { detail: error }));
        });
    });
  </script>
</body>
</html>